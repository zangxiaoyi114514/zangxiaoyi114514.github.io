"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[957],{1590:function(e,s,i){i.d(s,{KD:function(){return n},NU:function(){return a},O_:function(){return t}});let n="storage-bucket-1259736960",a="ap-chengdu",t=[{index:0,chinese:"2D",english:"2d"},{index:1,chinese:"3D",english:"3d"},{index:2,chinese:"动作",english:"action"},{index:3,chinese:"射击",english:"shooter"},{index:4,chinese:"音游",english:"musical"},{index:5,chinese:"策略",english:"strategy"},{index:6,chinese:"RPG",english:"rpg"},{index:7,chinese:"肉鸽",english:"rouge-like"},{index:8,chinese:"生存",english:"survival"},{index:9,chinese:"恐怖",english:"horror"},{index:10,chinese:"解谜",english:"puzzle"},{index:11,chinese:"休闲",english:"casual"},{index:12,chinese:"运动",english:"sport"},{index:13,chinese:"竞速",english:"racing"},{index:14,chinese:"模拟",english:"simulation"},{index:15,chinese:"跑酷",english:"runner"},{index:16,chinese:"塔防",english:"tower-defense"}]},957:function(e,s,i){var n=i(7437),a=i(1590),t=i(2265),l=i(8458),r=i(4232);i(8820);var c=i(8724),d=i(7907),o=i(8338);let h=(0,r.default)(()=>Promise.all([i.e(960),i.e(475),i.e(562)]).then(i.bind(i,6714)),{loadableGenerated:{webpack:()=>[6714]},ssr:!1});s.Z=e=>{let{params:{modalId:s,initialData:i}}=e,[r,u]=(0,t.useState)([]),m=e=>{B(""),r.includes(e)?u(r.filter(s=>s!==e)):u([...r,e])},[x,p]=(0,t.useState)(""),[g,b]=(0,t.useState)(""),[f,v]=(0,t.useState)(null),[j,N]=(0,t.useState)(""),[w,y]=(0,t.useState)(!1),[I,S]=(0,t.useState)(!1),[k,C]=(0,t.useState)(""),[D,B]=(0,t.useState)("");(0,t.useEffect)(()=>{var e;p(i.gameName),b(i.videoId),N(i.description),u(null!==(e=i.genres)&&void 0!==e?e:[])},[]);let J=async()=>{if(""==x)C("*请输入游戏名称");else if(""==g)C("*请输入视频BV号");else if("BV"!=g.substring(0,2)||12!=g.length)C("*请输入正确视频BV号");else if(0==r.length)C("*请选择至少一个游戏分类");else if(""==j)C("*请输入下载链接");else{C(""),S(!0);let s=await fetch("/api/proxy?bvid="+g),i=await s.json();if(!s.ok){C("*上传出错, 请检查视频BV号"),S(!1);return}var e=i.data.pic;"http:"==e.substring(0,5)&&(e=e.replace("http:","https:")),f?V(i):(await O({videoId:g,gameName:x,genres:r,description:j,videoTitle:i.data.title,videoPic:e,timestamp:i.data.pubdate,ownerName:i.data.owner.name,ownerAvatar:i.data.owner.face,ownerUid:i.data.owner.mid}),S(!1))}},V=e=>{o.Q.putObject({Bucket:a.KD,Region:a.NU,Key:g+".avif",Body:f,Headers:{"Pic-Operations":JSON.stringify({is_pic_info:1,rules:[{fileid:g+".avif",rule:"imageMogr2/thumbnail/382x/format/avif/interlace/1"}]})}},function(s,i){console.log(s||i),i?O({videoId:g,gameName:x,genres:r,description:j,videoTitle:e.data.title,videoPic:"https://"+i.Location,timestamp:e.data.pubdate,ownerName:e.data.owner.name,ownerAvatar:e.data.owner.face,ownerUid:e.data.owner.mid}).then(()=>{S(!1)}):(C("*封面上传出错, 请重试"),S(!1))})},O=async e=>{let s=(0,l.e)(),{error:i}=await s.from("games").upsert(e).select();i?(console.log(i),C("上传出错: "+i.message)):(b(""),p(""),u([]),N(""),B("上传成功!"))},U=(0,d.useRouter)();return(0,n.jsx)("div",{children:(0,n.jsx)("dialog",{id:s,className:"modal",onClose:()=>{"上传成功!"==D&&U.refresh()},children:(0,n.jsxs)("div",{className:"modal-box max-w-5xl",children:[(0,n.jsx)("form",{method:"dialog",children:(0,n.jsx)("button",{className:"btn btn-sm btn-circle btn-ghost absolute right-2 top-2",disabled:I,children:"✕"})}),(0,n.jsx)("h3",{className:"font-bold text-lg",children:""!=i.videoId?"修改信息":"上传新游戏"}),(0,n.jsxs)("div",{className:"px-5 py-10 md:px-20",children:[(0,n.jsxs)("label",{className:"input input-bordered input-primary flex items-center gap-2 mb-2",children:[(0,n.jsx)("p",{className:"w-20",children:"游戏名称"}),(0,n.jsx)("input",{type:"text text-center",className:"grow",placeholder:"植物大战僵尸",value:x,onChange:e=>{p(e.target.value),B("")}})]}),(0,n.jsxs)("label",{className:"input input-bordered input-primary flex items-center gap-2 mb-2",children:[(0,n.jsx)("p",{className:"w-20 text-center",children:"视频BV"}),(0,n.jsx)("input",{type:"text",className:"grow",placeholder:"BV1Wu411Y7H1",onChange:e=>{b(e.target.value),B("")},value:g})]}),(0,n.jsxs)("div",{className:"flex items-center mt-3",children:[(0,n.jsx)("p",{className:"w-20 mr-auto",children:"分类："}),(0,n.jsxs)("select",{className:"select select-sm select-primary w-20",value:"添加",onChange:e=>m(e.target.value),disabled:r.length>=4,children:[(0,n.jsx)("option",{disabled:!0,children:"添加"}),a.O_.map(e=>{if(!1==r.includes(e.chinese))return(0,n.jsx)("option",{children:e.chinese},e.english)})]})]}),r.length>0&&(0,n.jsx)("div",{className:"flex items-center my-5 ml-5",children:r.map(e=>(0,n.jsx)("div",{className:"badge badge-outline hover:text-white hover:bg-bilibili-blue  hover:cursor-pointer mx-2",onClick:()=>{m(e)},children:e},e))}),(0,n.jsxs)("div",{children:[(0,n.jsxs)("div",{className:"label",children:[(0,n.jsx)("span",{className:"label-text text-base",children:"游戏描述 (支持MarkDown):"}),(0,n.jsx)("div",{className:"ml-auto",children:(0,n.jsxs)("label",{className:"label cursor-pointer",children:[(0,n.jsx)("span",{className:"label-text mr-2",children:"预览"}),(0,n.jsx)("input",{type:"checkbox",className:"toggle",checked:w,onChange:e=>y(!w)})]})})]}),(0,n.jsx)(h,{value:j,onChange:e=>{N(e),B("")}})]}),w&&(0,n.jsxs)("div",{children:[(0,n.jsx)("div",{className:"text-base mb-1",children:"预览:"}),""==j?(0,n.jsx)("div",{className:"text-red-400",children:"无内容"}):(0,n.jsx)("article",{className:"prose prose-a:text-blue-400 hover:prose-a:text-blue-600 outline outline-primary rounded-sm max-w-full p-3",children:(0,n.jsx)(c.D,{children:j})})]})]}),""!=D&&(0,n.jsx)("div",{className:"w-full flex justify-center",children:(0,n.jsx)("p",{className:"text-green-400 font-bold -mt-5 mb-5",children:D})}),""!=k&&(0,n.jsx)("div",{className:"w-full flex justify-center",children:(0,n.jsx)("p",{className:"text-red-400 font-bold -mt-5 mb-5",children:k})}),(0,n.jsx)("div",{className:"w-full flex justify-center",children:(0,n.jsx)("button",{className:"btn px-10",onClick:J,children:I?(0,n.jsx)("span",{className:"loading loading-spinner loading-md"}):(0,n.jsx)("div",{children:"上传"})})})]})})})}},8458:function(e,s,i){i.d(s,{e:function(){return a}});var n=i(1880);let a=()=>(0,n.AY)("https://qpvbnafhudgfmmmemhfn.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InFwdmJuYWZodWRnZm1tbWVtaGZuIiwicm9sZSI6ImFub24iLCJpYXQiOjE3MTE3MDU1ODIsImV4cCI6MjAyNzI4MTU4Mn0.X_OZhmxDVh6HUntL_WxeSesdPcDj-9goLJChoVxe46A")},8338:function(e,s,i){i.d(s,{Q:function(){return a}});var n=i(6294);let a=new(i.n(n)())({SecretId:"AKID9B0b6qSwP4buzqTBKNK94nZLsNuMcgYE",SecretKey:"bUK5h8LKD1sY3Ree3PjuLtJcu0pUG0a9"})}}]);